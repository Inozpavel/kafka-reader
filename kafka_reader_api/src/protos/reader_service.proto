syntax = "proto3";

import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";

option csharp_namespace = "Kafka.Reader.Api";
option go_package = "kafka_reader_api";

package kafka_reader_api;

service KafkaReader {
  rpc ReadMessages(ReadMessages.Request) returns (stream ReadMessages.Response);
}

message ReadMessages {
  message Request {
    repeated string brokers = 1;
    string topic = 2;
    MessageFormat key_format = 3;
    MessageFormat body_format = 4;
    StartFrom start_from = 5;
    ReadLimit limit = 6;
    ValueFilter body_filter = 7;
    ValueFilter key_filter = 8;
  }
  message MessageFormat {
    oneof format {
      StringFormat string_format = 1;
      HexFormat hex_format = 2;
      ProtoFormat proto_format = 3;
      Ignore ignore = 4;
    }
    message StringFormat {}
    message HexFormat {}
    message ProtoFormat {
      oneof decode_way {
        RawProtoFile raw_proto_file = 1;
      }
    }
    message RawProtoFile{
      string proto = 1;
    }
    message Ignore {}
  }
  message StartFrom {
    oneof from {
      FromBeginning beginning = 1;
      FromLatest latest = 2;
      FromToday today = 3;
    }
    message FromBeginning {}
    message FromLatest {}
    message FromToday {}
  }
  message ValueFilter {
    string regex_value = 1;
    Condition condition = 2;
    message Condition {
      oneof condition {
        Contains contains = 1;
        NotContains no_contains = 2;
      }
    }
    message Contains {}
    message NotContains {}
  }
  message ReadLimit {
    oneof limit {
      NoLimit no_limit = 1;
      MessageCount message_count = 2;
      ToDate to_date = 3;
    }
    message NoLimit {}
    message MessageCount {
      uint64 count = 1;
    }
    message ToDate {
      google.protobuf.Timestamp date = 1;
    }
  }

  message Response {
    KafkaMessage kafka_message = 1;
  }
  message KafkaMessage{
    google.protobuf.Timestamp timestamp = 1;
    google.protobuf.StringValue key = 2;
    google.protobuf.StringValue body = 3;
    map<string, string> headers = 4;
  }
}